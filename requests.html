<script>
  function loadRequests() {
    let requests = JSON.parse(localStorage.getItem("returnRequests")) || [];

    // ðŸ‘‰ Pre-fill dummy requests if empty
    if (requests.length === 0) {
      requests = [
        "The Alchemist â†’ Sarah",
        "Atomic Habits â†’ Mike"
      ];
      localStorage.setItem("returnRequests", JSON.stringify(requests));
    }

    const list = document.getElementById("requestList");
    list.innerHTML = "";

    requests.forEach((req, index) => {
      const li = document.createElement("li");
      li.innerHTML = `
        ${req}
        <button class="complete-btn" onclick="markComplete(${index}, '${req}')">âœ… Mark as Returned</button>
      `;
      list.appendChild(li);
    });
  }

  function markComplete(index, bookInfo) {
    let requests = JSON.parse(localStorage.getItem("returnRequests")) || [];
    requests.splice(index, 1); // remove request
    localStorage.setItem("returnRequests", JSON.stringify(requests));

    // ðŸ‘‰ Move book back to "My Books" in Profile
    let myBooks = JSON.parse(localStorage.getItem("myBooks")) || [];
    let lentBooks = JSON.parse(localStorage.getItem("lentBooks")) || [];

    // remove from lentBooks
    lentBooks = lentBooks.filter(b => !bookInfo.includes(b));
    // add back to myBooks
    myBooks.push(bookInfo.split("â†’")[0].trim());

    localStorage.setItem("myBooks", JSON.stringify(myBooks));
    localStorage.setItem("lentBooks", JSON.stringify(lentBooks));

    loadRequests();
  }

  window.onload = loadRequests;
</script>
