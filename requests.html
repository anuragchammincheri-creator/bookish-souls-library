<script>
  function loadRequests() {
    let requests = JSON.parse(localStorage.getItem("returnRequests")) || [];
    const list = document.getElementById("requestList");
    list.innerHTML = "";

    if (requests.length === 0) {
      list.innerHTML = "<p>No return requests yet ðŸ“­</p>";
      return;
    }

    requests.forEach((req, index) => {
      const li = document.createElement("li");
      li.innerHTML = `
        ${req.book} â†’ Borrower: ${req.borrower}
        <button class="complete-btn" onclick="markComplete(${index})">âœ… Mark as Returned</button>
      `;
      list.appendChild(li);
    });
  }

  function markComplete(index) {
    let requests = JSON.parse(localStorage.getItem("returnRequests")) || [];
    let myBooks = JSON.parse(localStorage.getItem("myBooks")) || [];
    let lentBooks = JSON.parse(localStorage.getItem("lentBooks")) || [];

    const returned = requests[index];

    // 1. Remove from requests
    requests.splice(index, 1);
    localStorage.setItem("returnRequests", JSON.stringify(requests));

    // 2. Remove from lentBooks
    lentBooks = lentBooks.filter(b => b.book !== returned.book);
    localStorage.setItem("lentBooks", JSON.stringify(lentBooks));

    // 3. Add to myBooks
    myBooks.push(returned.book);
    localStorage.setItem("myBooks", JSON.stringify(myBooks));

    loadRequests(); // refresh
    alert(`âœ… ${returned.book} returned and moved back to My Books.`);
  }

  window.onload = loadRequests;
</script>
