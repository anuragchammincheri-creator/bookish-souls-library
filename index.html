<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookish Soul's Library - Home</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f5f2;
      color: #333;
    }

    header {
      background: #4a6fa5;
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
    }

    /* Notification */
    .notification { position: relative; margin-right: 1rem; cursor: pointer; }
    .notification .bell { font-size: 1.6rem; }
    .notification-badge {
      position: absolute; top: -5px; right: -5px;
      background: red; color: white; font-size: 0.7rem;
      padding: 2px 5px; border-radius: 50%;
    }
    .dropdown {
      display: none; position: absolute; right: 0; top: 35px;
      background: white; width: 350px; max-height: 300px; overflow-y: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2); border-radius: 8px; z-index: 10;
    }
    .dropdown.active { display: block; }
    .dropdown h4 {
      margin: 0; padding: 0.7rem; background: #4a6fa5; color: white;
      font-size: 1rem; position: sticky; top: 0;
    }
    .dropdown ul { list-style: none; margin: 0; padding: 0; }
    .dropdown ul li {
      display: flex; gap: 10px; padding: 0.8rem; border-bottom: 1px solid #eee;
      font-size: 0.9rem; align-items: center;
    }
    .dropdown ul li img {
      width: 40px; height: 60px; object-fit: cover; border-radius: 4px;
    }
    .notif-text { display: flex; flex-direction: column; }
    .notif-text strong { color: #2e3a59; }
    .notif-text span { font-size: 0.85rem; color: #555; }
    .notif-text em { font-size: 0.8rem; color: #d9534f; }

    /* Navbar */
    .navbar {
      background: #4a6fa5;
      display: flex; justify-content: center; gap: 1.5rem;
      padding: 0.8rem; border-bottom: 3px solid #2e3a59;
    }
    .navbar a {
      color: white; text-decoration: none; font-size: 1.1rem; font-weight: bold;
      transition: color 0.3s, background 0.3s; padding: 0.3rem 0.6rem; border-radius: 6px;
    }
    .navbar a:hover { background: white; color: #4a6fa5; }

    /* Main Content */
    main { padding: 2rem; max-width: 900px; margin: auto; text-align: center; }
    h1 { color: #2e3a59; }

    /* Events */
    .event-card {
      background: white; padding: 1rem; margin: 1rem 0;
      border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
    .event-card h2 { margin: 0; color: #4a6fa5; }
    .event-card p { margin: 0.3rem 0; }

    /* Footer */
    footer {
      margin-top: 3rem; background: #4a6fa5; color: white;
      text-align: center; padding: 1rem; position: relative;
    }
  </style>
</head>
<body>
  <header>
    üìö Bookish Soul's Library
    <div class="notification" onclick="toggleDropdown()">
      <span class="bell">üîî</span>
      <span class="notification-badge" id="notifBadge">0</span>
      <div class="dropdown" id="notifDropdown">
        <h4>Notifications</h4>
        <ul id="notifList"></ul>
      </div>
    </div>
  </header>

  <!-- NAVBAR -->
  <nav class="navbar">
    <a href="index.html">üè† Home</a>
    <a href="catalog.html">üìö Catalog</a>
    <a href="profile.html">üë§ Profile</a>
    <a href="requests.html">üì¨ Requests</a>
  </nav>

  <main>
    <h1>Welcome to Bookish Soul's Library</h1>
    <p>A community-driven free library where readers share and borrow books.</p>
    <p>Explore the catalog, request books, and connect with fellow book lovers üìö‚ú®</p>

    <h1>üìÖ Upcoming Events</h1>
    <div id="events"></div>
  </main>

  <footer>
    &copy; 2025 Bookish Soul's Library
  </footer>

  <script>
    function toggleDropdown() {
      document.getElementById("notifDropdown").classList.toggle("active");
    }

    function loadNotifications() {
      const notifList = document.getElementById("notifList");
      notifList.innerHTML = "";
      let requests = JSON.parse(localStorage.getItem("returnRequests")) || [];
      let currentUser = localStorage.getItem("currentUser") || "Ravi Kumar";
      let myNotifications = requests.filter(req => req.borrower === currentUser);

      if (myNotifications.length === 0) {
        notifList.innerHTML = "<li style='padding:1rem;text-align:center;color:#555;'>No notifications</li>";
      } else {
        myNotifications.forEach(req => {
          const li = document.createElement("li");
          li.innerHTML = `
            <img src="${req.cover || 'https://via.placeholder.com/40x60'}" alt="${req.book}">
            <div class="notif-text">
              <strong>${req.book}</strong>
              <span>Owner: ${req.owner}</span>
              <em>${req.message || 'Please return the book you borrowed'}</em>
            </div>
          `;
          notifList.appendChild(li);
        });
      }
      document.getElementById("notifBadge").textContent = myNotifications.length;
    }

    loadNotifications();

    // Load Events (auto-generated from requests)
    function loadEvents(){
      const requests=JSON.parse(localStorage.getItem("requests"))||[];
      const eventDiv=document.getElementById("events");
      eventDiv.innerHTML="";

      if(requests.length===0){
        eventDiv.innerHTML="<p>No events scheduled yet. Borrow more books to create reading trends! üìö</p>";
        return;
      }

      const bookCount={};
      requests.forEach(r=>{
        if(r.status==="borrowed"||r.status==="returned"){
          bookCount[r.title]=(bookCount[r.title]||0)+1;
        }
      });

      const topBooks=Object.entries(bookCount).sort((a,b)=>b[1]-a[1]).slice(0,3);

      if(topBooks.length===0){
        eventDiv.innerHTML="<p>No active events. Start borrowing to unlock book club events! üìñ</p>";
        return;
      }

      topBooks.forEach(([title,count],idx)=>{
        const card=document.createElement("div");
        card.className="event-card";
        card.innerHTML=`
          <h2>üìö ${title} - Reading Meetup</h2>
          <p><strong>Date:</strong> ${new Date(Date.now() + (idx+1)*7*24*60*60*1000).toDateString()}</p>
          <p><strong>Location:</strong> Online Book Club</p>
          <p><strong>Readers Count:</strong> ${count} people borrowed/requested this book</p>
        `;
        eventDiv.appendChild(card);
      });
    }
    loadEvents();
  </script>

  <!-- ‚úÖ Firebase Setup -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBvplQCpz-pIeT8ptEDF8Gj2acD9gcE_JA",
      authDomain: "bookish-soul-s-library.firebaseapp.com",
      projectId: "bookish-soul-s-library",
      storageBucket: "bookish-soul-s-library.firebasestorage.app",
      messagingSenderId: "718849773540",
      appId: "1:718849773540:web:e9b42aad3427e081a5c1f1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    console.log("üî• Firebase Connected!");
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // üî• Replace with your actual Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function seedData() {
    try {
      // üìö Books
      const books = [
        { title: "The Alchemist", author: "Paulo Coelho", available: true, cover: "https://covers.openlibrary.org/b/id/8231996-L.jpg" },
        { title: "Atomic Habits", author: "James Clear", available: true, cover: "https://covers.openlibrary.org/b/id/9254155-L.jpg" },
        { title: "Harry Potter and the Sorcerer's Stone", author: "J.K. Rowling", available: true, cover: "https://covers.openlibrary.org/b/id/7984916-L.jpg" },
        { title: "The Power of Now", author: "Eckhart Tolle", available: true, cover: "https://covers.openlibrary.org/b/id/240726-L.jpg" },
        { title: "Think and Grow Rich", author: "Napoleon Hill", available: true, cover: "https://covers.openlibrary.org/b/id/10909258-L.jpg" }
      ];
      for (let book of books) await addDoc(collection(db, "books"), book);

      // üë§ Users
      const users = [
        { name: "Alice Reader", email: "alice@example.com" },
        { name: "Bob Writer", email: "bob@example.com" },
        { name: "Charlie Borrower", email: "charlie@example.com" }
      ];
      for (let user of users) await addDoc(collection(db, "users"), user);

      // üì¨ Requests
      const requests = [
        { book: "The Alchemist", borrower: "Alice Reader", status: "pending" },
        { book: "Atomic Habits", borrower: "Charlie Borrower", status: "borrowed" }
      ];
      for (let req of requests) await addDoc(collection(db, "requests"), req);

      console.log("‚úÖ Dummy data seeded successfully!");
      alert("Firestore dummy data added! Check your Firebase Console.");
    } catch (e) {
      console.error("‚ùå Error seeding data:", e);
    }
  }

  seedData();
  </script>
</body>
</html>
